server:
  address: 0.0.0.0
  port: 8081
spring:
  profiles:
    active: ${SPRING_PROFILES_ACTIVE}
  application:
    name: web_programming_grading_executor
  datasource:
    driver-class-name: org.postgresql.Driver
    hikari:
      # Minimum number of idle connections in the pool
      minimum-idle: 5
      # Maximum number of connections in the pool
      maximum-pool-size: 50
      # Maximum time (ms) a connection can be idle before being closed
      idle-timeout: 600000  # 10 minutes (increased from 1 min for stability)
      # Maximum time (ms) to wait for a connection from the pool
      connection-timeout: 30000  # 30 seconds
      # Maximum lifetime (ms) of a connection in the pool
      max-lifetime: 1800000  # 30 minutes (helps with DB connection limits)
  flyway:
    enabled: true
    baseline-on-migrate: true
    locations: classpath:db/migration
    schemas: defaultdb
  jpa:
    properties:
      hibernate:
        default_schema: defaultdb
        # DDL auto (disabled since Flyway handles migrations)
        ddl-auto: none
        # Show SQL queries in logs (set to false in prod)
        show_sql: true
        # Format SQL for readability
        format_sql: true
        jdbc:
          batch_size: 20
          order_inserts: true
          order_updates: true
          batch_versioned_data: true
    open-in-view: false
  servlet:
    multipart:
      max-file-size: 20MB
      max-request-size: 20MB

logging:
  file:
    name: ./log/web_programming_grading_executor.log
feign:
  # Use OkHttp for better performance (already enabled)
  okhttp:
    enabled: true
  # Hystrix circuit breaker (optional; enable if using Hystrix)
  hystrix:
    enabled: false  # Set to true if you add Hystrix dependency
  # Client configurations
  client:
    config:
      default:
        # Connection timeout (ms)
        connect-timeout: 30000  # 30 seconds
        # Read timeout (ms) - increased for large responses
        read-timeout: 360000  # 6 minutes
        # Logger level (basic, headers, full)
        logger-level: basic
        # Retry policy
        retryer: feign.Retryer.Default
        # Request interceptor (if needed for auth)
        request-interceptors:
          - com.example.MyRequestInterceptor  # Replace with your class
        # Error decoder (custom error handling)
        error-decoder: com.example.MyErrorDecoder  # Replace with your class
        # Encoder/Decoder (default is Jackson)
        encoder: feign.jackson.JacksonEncoder
        decoder: feign.jackson.JacksonDecoder
  # Compression (reduce payload size)
  compression:
    request:
      enabled: true
      mime-types: text/xml,application/xml,application/json
      min-request-size: 2048
    response:
      enabled: true